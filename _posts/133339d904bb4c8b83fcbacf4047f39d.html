---
layout: project
title: test
image: assets/images/02-Renting-banner.jpg
description: Text data cleaning and machine learning using Python
---

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>7616b5ae09604153babe16c350f7ded8</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell code" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>RSEED <span class="op">=</span> <span class="dv">30</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="3">
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;leasing_opportunity.csv&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="4">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>building_id</th>
      <th>created</th>
      <th>description</th>
      <th>display_address</th>
      <th>features</th>
      <th>latitude</th>
      <th>listing_id</th>
      <th>longitude</th>
      <th>manager_id</th>
      <th>photos</th>
      <th>price</th>
      <th>street_address</th>
      <th>is_deal</th>
      <th>gender</th>
      <th>expected_price</th>
      <th>followup</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.5</td>
      <td>3</td>
      <td>53a5b119ba8f7b61d4e010512e0dfc85</td>
      <td>24/06/2016 7:54</td>
      <td>A Brand New 3 Bedroom 1.5 bath ApartmentEnjoy ...</td>
      <td>Metropolitan Avenue</td>
      <td>[]</td>
      <td>40.7145</td>
      <td>7211212</td>
      <td>-73.9425</td>
      <td>5ba989232d0489da1b5f2c45f6688adc</td>
      <td>['https://photos.renthop.com/2/7211212_1ed4542...</td>
      <td>3000.0</td>
      <td>792 Metropolitan Avenue</td>
      <td>1</td>
      <td>female</td>
      <td>2700.0</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>c5c8a357cba207596b04d1afd1e4f130</td>
      <td>12/06/2016 12:19</td>
      <td></td>
      <td>Columbus Avenue</td>
      <td>['Doorman', 'Elevator', 'Fitness Center', 'Cat...</td>
      <td>40.7947</td>
      <td>7150865</td>
      <td>-73.9667</td>
      <td>7533621a882f71e25173b27e3139d83d</td>
      <td>['https://photos.renthop.com/2/7150865_be3306c...</td>
      <td>5465.0</td>
      <td>808 Columbus Avenue</td>
      <td>0</td>
      <td>male</td>
      <td>5200.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>c3ba40552e2120b0acfc3cb5730bb2aa</td>
      <td>17/04/2016 3:26</td>
      <td>Top Top West Village location, beautiful Pre-w...</td>
      <td>W 13 Street</td>
      <td>['Laundry In Building', 'Dishwasher', 'Hardwoo...</td>
      <td>40.7388</td>
      <td>6887163</td>
      <td>-74.0018</td>
      <td>d9039c43983f6e564b1482b273bd7b01</td>
      <td>['https://photos.renthop.com/2/6887163_de85c42...</td>
      <td>2850.0</td>
      <td>241 W 13 Street</td>
      <td>1</td>
      <td>male</td>
      <td>2900.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>28d9ad350afeaab8027513a3e52ac8d5</td>
      <td>18/04/2016 2:22</td>
      <td>Building Amenities - Garage - Garden - fitness...</td>
      <td>East 49th Street</td>
      <td>['Hardwood Floors', 'No Fee']</td>
      <td>40.7539</td>
      <td>6888711</td>
      <td>-73.9677</td>
      <td>1067e078446a7897d2da493d2f741316</td>
      <td>['https://photos.renthop.com/2/6888711_6e660ce...</td>
      <td>3275.0</td>
      <td>333 East 49th Street</td>
      <td>0</td>
      <td>female</td>
      <td>3500.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>28/04/2016 1:32</td>
      <td>Beautifully renovated 3 bedroom flex 4 bedroom...</td>
      <td>West 143rd Street</td>
      <td>['Pre-War']</td>
      <td>40.8241</td>
      <td>6934781</td>
      <td>-73.9493</td>
      <td>98e13ad4b495b9613cef886d79a6291f</td>
      <td>['https://photos.renthop.com/2/6934781_1fa4b41...</td>
      <td>3350.0</td>
      <td>500 West 143rd Street</td>
      <td>0</td>
      <td>female</td>
      <td>3200.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="4">
<pre><code>Index([&#39;bathrooms&#39;, &#39;bedrooms&#39;, &#39;building_id&#39;, &#39;created&#39;, &#39;description&#39;,
       &#39;display_address&#39;, &#39;features&#39;, &#39;latitude&#39;, &#39;listing_id&#39;, &#39;longitude&#39;,
       &#39;manager_id&#39;, &#39;photos&#39;, &#39;price&#39;, &#39;street_address&#39;, &#39;is_deal&#39;, &#39;gender&#39;,
       &#39;expected_price&#39;, &#39;followup&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>price</th>
      <th>is_deal</th>
      <th>expected_price</th>
      <th>followup</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>48755.000000</td>
      <td>4.875500e+04</td>
      <td>53675.000000</td>
      <td>4.875500e+04</td>
      <td>26872.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-73.955557</td>
      <td>3.842052e+03</td>
      <td>0.234094</td>
      <td>3.791076e+03</td>
      <td>7.498735</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.185096</td>
      <td>2.220097e+04</td>
      <td>0.423435</td>
      <td>2.220123e+04</td>
      <td>4.614796</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-118.271000</td>
      <td>4.300000e+01</td>
      <td>0.000000</td>
      <td>-4.000000e+02</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-73.991700</td>
      <td>2.500000e+03</td>
      <td>0.000000</td>
      <td>2.400000e+03</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-73.977900</td>
      <td>3.150000e+03</td>
      <td>0.000000</td>
      <td>3.100000e+03</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>-73.954800</td>
      <td>4.100000e+03</td>
      <td>0.000000</td>
      <td>4.100000e+03</td>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.000000</td>
      <td>4.490000e+06</td>
      <td>1.000000</td>
      <td>4.489600e+06</td>
      <td>15.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 53675 entries, 0 to 53674
Data columns (total 18 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   bathrooms        49930 non-null  object 
 1   bedrooms         49949 non-null  object 
 2   building_id      49949 non-null  object 
 3   created          49949 non-null  object 
 4   description      48498 non-null  object 
 5   display_address  49316 non-null  object 
 6   features         49352 non-null  object 
 7   latitude         49352 non-null  object 
 8   listing_id       49272 non-null  object 
 9   longitude        48755 non-null  float64
 10  manager_id       48755 non-null  object 
 11  photos           48755 non-null  object 
 12  price            48755 non-null  float64
 13  street_address   48745 non-null  object 
 14  is_deal          53675 non-null  int64  
 15  gender           53675 non-null  object 
 16  expected_price   48755 non-null  float64
 17  followup         26872 non-null  float64
dtypes: float64(4), int64(1), object(13)
memory usage: 7.4+ MB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.hist(figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">10</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_133339d904bb4c8b83fcbacf4047f39d/3ab1ce019cb690f2c5e5fc1a83f2feb912438c2e.png" /></p>
</div>
</div>
<div class="cell markdown">
<h2 id="1-data-cleaning">1. data cleaning</h2>
<ul>
<li>如何处理NaN</li>
<li>如何处理异常值（price = 1000000）</li>
</ul>
<h2 id="2-feature-understaing">2. feature understaing</h2>
<ul>
<li>看看feature和target(is_deal)之间的correlation</li>
</ul>
<h2 id="feature-engineering">feature engineering</h2>
<ul>
<li>string --&gt; catagorial --&gt; feature</li>
<li>bin --&gt; catagorial feature</li>
</ul>
<h2 id="3-data-partitioning">3. data partitioning</h2>
<ul>
<li>k-fold</li>
</ul>
<h2 id="4-modeling">4. modeling</h2>
<ul>
<li>logistic</li>
<li>decision tree</li>
<li>random forest</li>
<li>xgboost</li>
</ul>
<h2 id="5-explanation-and-report">5. explanation and report</h2>
</div>
<section id="1-feature-engineering" class="cell markdown">
<h1>1. feature engineering</h1>
</section>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">
<pre><code>Index([&#39;bathrooms&#39;, &#39;bedrooms&#39;, &#39;building_id&#39;, &#39;created&#39;, &#39;description&#39;,
       &#39;display_address&#39;, &#39;features&#39;, &#39;latitude&#39;, &#39;listing_id&#39;, &#39;longitude&#39;,
       &#39;manager_id&#39;, &#39;photos&#39;, &#39;price&#39;, &#39;street_address&#39;, &#39;is_deal&#39;, &#39;gender&#39;,
       &#39;expected_price&#39;, &#39;followup&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> pd.DataFrame()</span></code></pre></div>
</div>
<section id="11-deal-with-bathrooms-bedrooms" class="cell markdown">
<h2>1.1 deal with bathrooms, bedrooms</h2>
</section>
<div class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;bathrooms&#39;</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">&#39;bathrooms&#39;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;bedrooms&#39;</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">&#39;bedrooms&#39;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_final[[<span class="st">&#39;bathrooms&#39;</span>, <span class="st">&#39;bedrooms&#39;</span>]] <span class="op">=</span> df[[<span class="st">&#39;bathrooms&#39;</span>, <span class="st">&#39;bedrooms&#39;</span>]]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df_final.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="7">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.5</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="12-deal-with-building_id" class="cell markdown">
<h2>1.2 deal with building_id</h2>
</section>
<div class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">
<pre><code>Index([&#39;bathrooms&#39;, &#39;bedrooms&#39;, &#39;building_id&#39;, &#39;created&#39;, &#39;description&#39;,
       &#39;display_address&#39;, &#39;features&#39;, &#39;latitude&#39;, &#39;listing_id&#39;, &#39;longitude&#39;,
       &#39;manager_id&#39;, &#39;photos&#39;, &#39;price&#39;, &#39;street_address&#39;, &#39;is_deal&#39;, &#39;gender&#39;,
       &#39;expected_price&#39;, &#39;followup&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;building_id has &#39;</span>, <span class="bu">len</span>(df[<span class="st">&#39;building_id&#39;</span>].unique()), <span class="st">&#39; unique values&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>building_id has  7662  unique values
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;listing_id has &#39;</span>, <span class="bu">len</span>(df[<span class="st">&#39;listing_id&#39;</span>].unique()), <span class="st">&#39; unique values&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>listing_id has  49229  unique values
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;manager_id has &#39;</span>, <span class="bu">len</span>(df[<span class="st">&#39;manager_id&#39;</span>].unique()), <span class="st">&#39; unique values&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>manager_id has  3470  unique values
</code></pre>
</div>
</div>
<section id="13-deal-with-description" class="cell markdown">
<h1>1.3 deal with description</h1>
</section>
<div class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;description&#39;</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="12">
<pre><code>0        A Brand New 3 Bedroom 1.5 bath ApartmentEnjoy ...
1                                                         
2        Top Top West Village location, beautiful Pre-w...
3        Building Amenities - Garage - Garden - fitness...
4        Beautifully renovated 3 bedroom flex 4 bedroom...
                               ...                        
53670    30TH/3RD, MASSIVE CONV 2BR IN LUXURY FULL SERV...
53671    HIGH END condo finishes, swimming pool, and ki...
53672    Large Renovated One Bedroom Apartment with Sta...
53673    Stylishly sleek studio apartment with unsurpas...
53674    Look no further!!!  This giant 2 bedroom apart...
Name: description, Length: 53675, dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install textblob</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Collecting textblob
  Downloading textblob-0.15.3-py2.py3-none-any.whl (636 kB)
Requirement already satisfied: nltk&gt;=3.1 in f:\python\lib\site-packages (from textblob) (3.5)
Requirement already satisfied: click in f:\python\lib\site-packages (from nltk&gt;=3.1-&gt;textblob) (7.1.2)
Requirement already satisfied: joblib in f:\python\lib\site-packages (from nltk&gt;=3.1-&gt;textblob) (0.16.0)
Requirement already satisfied: tqdm in f:\python\lib\site-packages (from nltk&gt;=3.1-&gt;textblob) (4.47.0)
Requirement already satisfied: regex in f:\python\lib\site-packages (from nltk&gt;=3.1-&gt;textblob) (2020.6.8)
Installing collected packages: textblob
Successfully installed textblob-0.15.3
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="14">
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">&#39;punkt&#39;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>[nltk_data] Downloading package punkt to
[nltk_data]     C:\Users\HP\AppData\Roaming\nltk_data...
[nltk_data]   Unzipping tokenizers\punkt.zip.
</code></pre>
</div>
<div class="output execute_result" data-execution_count="14">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> textblob <span class="im">import</span> TextBlob</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>string <span class="op">=</span> <span class="st">&#39;a happy day&#39;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>blob <span class="op">=</span> TextBlob(string)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>blob.sentiment</span></code></pre></div>
<div class="output execute_result" data-execution_count="15">
<pre><code>Sentiment(polarity=0.8, subjectivity=1.0)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>string <span class="op">=</span> <span class="st">&#39;a happy day. i am so happy&#39;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>blob <span class="op">=</span> TextBlob(string)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>blob.sentences</span></code></pre></div>
<div class="output execute_result" data-execution_count="16">
<pre><code>[Sentence(&quot;a happy day.&quot;), Sentence(&quot;i am so happy&quot;)]</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># description_list = list(df[&#39;description&#39;])</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># from textblob import TextBlob</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dscpt_polarity = []</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># dscpt_subjectivity = []</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for text in description_list:</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     blob = TextBlob(str(text))</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     polarity = []</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     subjectivity = []</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     for sentence in blob.sentences:</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         polarity.append(sentence.sentiment.polarity)</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">#         subjectivity.append(sentence.sentiment.subjectivity)</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     if len(polarity) &gt; 0:</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">#         avg_polarity = sum(polarity)/len(polarity)</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">#         avg_polarity = 0</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># #         avg_polarity = float(&quot;nan&quot;)</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     if len(subjectivity) &gt; 0:</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co">#         avg_subjectivity = sum(subjectivity)/len(subjectivity)</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="co">#         avg_polarity = 0</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #         avg_subjectivity = float(&#39;nan&#39;)</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     dscpt_polarity.append(avg_polarity)</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     dscpt_subjectivity.append(avg_subjectivity)</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> textblob <span class="im">import</span> TextBlob</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_sentiment(text):</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    blob <span class="op">=</span> TextBlob(<span class="bu">str</span>(text))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(blob.sentences) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    polarity <span class="op">=</span> [sentence.sentiment.polarity <span class="cf">for</span> sentence <span class="kw">in</span> blob.sentences]</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    subjectivity <span class="op">=</span> [sentence.sentiment.subjectivity <span class="cf">for</span> sentence <span class="kw">in</span> blob.sentences]</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    polarity_avg <span class="op">=</span> np.mean(polarity)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    subjectivity_avg <span class="op">=</span> np.mean(subjectivity)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (polarity_avg, subjectivity_avg)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;description&#39;</span>].iloc[<span class="dv">0</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="18">
<pre><code>&quot;A Brand New 3 Bedroom 1.5 bath ApartmentEnjoy These Following Apartment Features As You Rent Here? Modern Designed Bathroom w/ a Deep Spa Soaking Tub? Room to Room AC/Heat? Real Oak Hardwood Floors? Rain Forest Shower Head? SS steel Appliances w/ Chef Gas Cook Oven &amp; LG Fridge? washer /dryer in the apt? Cable Internet Ready? Granite Counter Top Kitchen w/ lot of cabinet storage spaceIt&#39;s Just A Few blocks To L Train&lt;br /&gt;&lt;br /&gt;Don&#39;t miss out!&lt;br /&gt;&lt;br /&gt;We have several great apartments in the immediate area.&lt;br /&gt;&lt;br /&gt;For additional information 687-878-2229&lt;p&gt;&lt;a  website_redacted &quot;</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="19">
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>get_sentiment(df[<span class="st">&#39;description&#39;</span>].iloc[<span class="dv">0</span>])</span></code></pre></div>
<div class="output execute_result" data-execution_count="19">
<pre><code>(0.16035353535353536, 0.3071969696969697)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="20">
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&#39;dscpt_polarity&#39;</span>, <span class="st">&#39;dscpt_subjectivity&#39;</span>]] <span class="op">=</span> df[[<span class="st">&#39;description&#39;</span>]].<span class="bu">apply</span>(get_sentiment, axis<span class="op">=</span><span class="dv">1</span>, result_type<span class="op">=</span><span class="st">&quot;expand&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_final[[<span class="st">&#39;dscpt_polarity&#39;</span>, <span class="st">&#39;dscpt_subjectivity&#39;</span>]] <span class="op">=</span> df[[<span class="st">&#39;dscpt_polarity&#39;</span>, <span class="st">&#39;dscpt_subjectivity&#39;</span>]]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_final.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="21">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>dscpt_polarity</th>
      <th>dscpt_subjectivity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.5</td>
      <td>3.0</td>
      <td>0.136364</td>
      <td>0.454545</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.616667</td>
      <td>0.666667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.500000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.850000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="hint-1-features这一列如何进行特征工程" class="cell markdown">
<h1>Hint 1: features这一列如何进行特征工程</h1>
</section>
<div class="cell markdown">
<p>features表示该公寓的一些特色，比如是否有电梯，是否有健身房等。这个特色会影响到一个租客最终是否签约。这一列本身的数据类似是string，string里面有list，list里面的每个element是真正的feature。我们如何提取这些featur进行训练呢？</p>
<p>原来</p>
<table>
<thead>
<tr class="header">
<th>features</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>doorman</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>elevater</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>NaN</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>特征工程后</p>
<table>
<thead>
<tr class="header">
<th>doorman</th>
<th>elevater</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>0</td>
<td>0</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="cell code" data-execution_count="22">
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;features&#39;</span>].head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="22">
<pre><code>0                                                   []
1    [&#39;Doorman&#39;, &#39;Elevator&#39;, &#39;Fitness Center&#39;, &#39;Cat...
2    [&#39;Laundry In Building&#39;, &#39;Dishwasher&#39;, &#39;Hardwoo...
3                        [&#39;Hardwood Floors&#39;, &#39;No Fee&#39;]
4                                          [&#39;Pre-War&#39;]
Name: features, dtype: object</code></pre>
</div>
</div>
<div class="cell markdown">
<p>df.loc[df['features'].isnull(), 'features']</p>
</div>
<div class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;features&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;features&#39;</span>].fillna(<span class="st">&#39;[]&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="op">~</span>df[<span class="st">&#39;features&#39;</span>].<span class="bu">str</span>.contains(<span class="st">&#39;\[&#39;</span>), <span class="st">&#39;features&#39;</span>].unique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="25">
<pre><code>array([&#39;92758310b2a962b943484e8be0237a19&#39;,
       &#39;4bdc3d8c1aaa90d997ce2cb77680679b&#39;,
       &#39;624c1fbd75e5f99e6a7164cce1b1b8a4&#39;,
       &#39;ff707b7f0a2ea94a26c784f06c9fec69&#39;,
       &#39;699c325b818541f314b691b76f3238d7&#39;,
       &#39;a1e83422f637157e3c14ab88d585b769&#39;,
       &#39;5c11016f3d21d673b15db9f058c90200&#39;,
       &#39;a621bebe105d26cd338d4c54f35f52e6&#39;,
       &#39;c80aad40b6abd065b4aefee40a2154f6&#39;,
       &#39;8b53ccf4338806ab1be3dd0267711649&#39;,
       &#39;f510c42fc9e8765f19317cf2f84e3114&#39;,
       &#39;536aaedf27d13fb487c142dae8133211&#39;,
       &#39;c71cf1f472cf9b4b4517ea23fb6f2c91&#39;,
       &#39;e6472c7237327dd3903b3d6f6a94515a&#39;,
       &#39;b4518af7cc5d79517aca4157f1614478&#39;,
       &#39;407ffad8d323810a4712d1446d5ad457&#39;,
       &#39;90ddcebc5f1df89389cbc519535e0f2a&#39;,
       &#39;df86259b169a78c024e4d5206d48cf44&#39;,
       &#39;4bb850e243db09298a0bda50f9a99c81&#39;,
       &#39;7892b9714d30934b1863796d61fbb81c&#39;,
       &#39;6c2a16187e6855c132bb496b875a4ef7&#39;,
       &#39;ef6323ef586350bb4f8dc78d924e856a&#39;,
       &#39;d69d4e111612dd12ef864031c1148543&#39;,
       &#39;a4a468c229a6094d3811489361d08819&#39;,
       &#39;0492625ca98a35bd7d75849f6b4944ae&#39;,
       &#39;7775d78b3c97487fba1df0727f4b167b&#39;,
       &#39;fd1d4ee0095d41d209e23530141eaabf&#39;,
       &#39;952078cf22eae4e31eb70604c9d4220c&#39;,
       &#39;b4405fd648b8ebd2b98861d6aa8e4969&#39;,
       &#39;19f0651b8a5f76062fe2c9369e2dd76c&#39;,
       &#39;1f286bebfce89e810809880775f11a26&#39;,
       &#39;72db53045d9648ddb3023fa80885a49c&#39;,
       &#39;8d2926bae27fce9f700b488934563844&#39;,
       &#39;836119ecf05f96f399c7f3df34dee1a7&#39;,
       &#39;287e23e5a3f64c939cdb8109713b25e4&#39;,
       &#39;edd073f8dea85637f8b7d589faa7902b&#39;,
       &#39;d0f2082e8b795095061785ef5e8ac9e7&#39;,
       &#39;f07272f8ceb99db4c1a7cbbd9ae7b75b&#39;,
       &#39;0cb0dc4da84b0d97c6e3ccb369aba83e&#39;,
       &#39;63da1f6025a369fa2c4b036130784a84&#39;,
       &#39;465641627d253016ac8683943fd94ffe&#39;,
       &#39;32396a0a600b721a4a7655d4ddcedc4d&#39;,
       &#39;d23f9a9e6b9f6003f26017bda6dd1cb2&#39;,
       &#39;b9e74dc56199a8e6577aa8bb3550f1e4&#39;,
       &#39;89b262f811547861d9cccc374be275d0&#39;,
       &#39;6b3fc4bf56631914dce770d406ed8007&#39;,
       &#39;10b1ae0a38d50b7ba0cee612d14af9eb&#39;,
       &#39;0bafd514443193d057e8a60e45cb7ea6&#39;,
       &#39;b8459916140cbfc69344eab991b441bd&#39;,
       &#39;bf2f68c09a8f9b6287b4e1f7cbedce65&#39;,
       &#39;c9d2c946c5c94b549d2029b024e5aaa1&#39;,
       &#39;0ed22c41834a89b0905341a4883bcfd8&#39;,
       &#39;cfa86c14c312b92a7d035bd3437c2043&#39;,
       &#39;97c4e11df6603e1dd21d88c7fc18013d&#39;,
       &#39;e2aa71ea7e46aa975a6cefa35f64d28b&#39;,
       &#39;524a48d3526730bec7262442b3aa9a94&#39;,
       &#39;829999af312c93d6b1d1520dbad4983f&#39;,
       &#39;f289f53a367315caae592753ba0bc63d&#39;,
       &#39;b7a1f2d6ea66497b087690e796ca43ba&#39;,
       &#39;381152a75a238372d3d475934219eb6d&#39;,
       &#39;205f1a20fe0ebac01902c71a15dfbc9b&#39;,
       &#39;b68f249ae0aeb220626960fa1934c418&#39;,
       &#39;3ab7c26842f970df4f7dc555dffc387d&#39;,
       &#39;f2e973c3ef0c652556f3006a51bce015&#39;,
       &#39;09e098b612b87107ff4f047cff3acfec&#39;,
       &#39;84a317f6bce6e3c05dec6fb070dd7e0b&#39;,
       &#39;d2b7068bc4e5e74ba13954559d1d120d&#39;,
       &#39;6894090792e447da3d8c2817c6577ea5&#39;,
       &#39;f32c29c47890054822a062c48ed0229f&#39;,
       &#39;d4444244953f1ba2045b446e0b40543f&#39;,
       &#39;a820f872b24c51a030b4d25059fbaac8&#39;,
       &#39;ce9605e5f21262b82deb0c5ef10dcf45&#39;,
       &#39;f5e44ef976867c828130d0e6e6cdbda5&#39;,
       &#39;29351e3e25283e3c6c324f7d0904153b&#39;,
       &#39;bc9a2ff7c931ce7de08f50d429134a16&#39;,
       &#39;87b5619c569d2d9a8fb8c91d901b7b54&#39;,
       &#39;8d425b08cdf4dec134bf5b714ebac267&#39;,
       &#39;c0a635e032b6a0f40ba7bc1e5ebf4809&#39;,
       &#39;1badf2eefe8228387979149413ec071b&#39;,
       &#39;b0bea7357fc07d2716c68644dc8a312c&#39;,
       &#39;f2e87488529935faf3c8411e63259564&#39;,
       &#39;12b91a24a6af821a5912bc417ec43e8d&#39;,
       &#39;3969aa2ff2f266ea82a886e0c084abc7&#39;,
       &#39;a936cd07895efded15c36140a62a78b7&#39;,
       &#39;94db062fa1178ab999bdd777dafec65f&#39;,
       &#39;17204fa7e500e3ea4efb3e0f801669aa&#39;,
       &#39;8c581022a9e77237c66336f8f17fa14d&#39;,
       &#39;ba82cb585bc2be6819241b2d1c900b88&#39;,
       &#39;44736fb7de33f8ea3c34c0500e6932c3&#39;,
       &#39;9ab3ec6493d605fa0effea43b1141f6f&#39;,
       &#39;ae7c6a59583fd40eac4d3855316f0ac2&#39;,
       &#39;468e656e59a57f84bf2bf37e480aa832&#39;,
       &#39;0c1091b0e6fcebff367ba688403f5c84&#39;,
       &#39;9daa743d34f2bf6917a2ce0c1716784f&#39;,
       &#39;babf967aeb47132007ac2dd76c204d49&#39;,
       &#39;77a2ec69c31af35bad629aeef64322d9&#39;,
       &#39;77a807f61bff3244a81c0d8f0ea0c508&#39;,
       &#39;1014a43e89b749c41b1385d09539b94d&#39;,
       &#39;973160cfdb58538169ea1c24f87561e3&#39;,
       &#39;2279c1b4b458c7060354f77cef33b24e&#39;,
       &#39;53f240454714b223c7aaa73437c24e8a&#39;,
       &#39;cd60972dd4dc63f11aff82ac42c8ba98&#39;,
       &#39;eef47ed8f4645412e7130f334aa53ca7&#39;,
       &#39;d9039c43983f6e564b1482b273bd7b01&#39;,
       &#39;90cdd68b0a4ed66ef71d66e55d3fbd8a&#39;,
       &#39;c0999793234144881eeec9cecb1c4b8f&#39;,
       &#39;95f23db28b91c719b620588a76baf84a&#39;,
       &#39;efb12e02cfab31245ab533767b69aeb5&#39;,
       &#39;7c5e4fc025b70c6540d6b0e06716b9dd&#39;,
       &#39;5d460ddca5fd522ceca75feccf5ef81d&#39;,
       &#39;e9920062e07ee893c10e38d0259665b0&#39;,
       &#39;c1f6424c975f2dab361f8e4f5a1095f1&#39;,
       &#39;e6da894cf7ae0e99fe17a29c72e387c9&#39;,
       &#39;908e2fdb7d9ac7d0d9220b60f1292c3a&#39;,
       &#39;539c94e309b65a4089e490808c35c154&#39;,
       &#39;449b6bcfbef98f7cd8fdb1acfac20097&#39;,
       &#39;1f83758a257b3ded8e8cce14b14bf533&#39;,
       &#39;d0322634dbf7c6e01bc2b58f91bb0d90&#39;,
       &#39;cd078a92365061d97bec61e145a713b2&#39;,
       &#39;dc87fe2210e71c6fb37a56ed032754bf&#39;,
       &#39;6e88a2a196e4107504206effc554c922&#39;,
       &#39;79043887df9d409475245ca4fc3bfabe&#39;,
       &#39;d4da529f5295859bb5c4ef8abbb0a38f&#39;,
       &#39;4e0c2b0aee8d6e71d3ba9eb83ee09836&#39;,
       &#39;1d3f3acbd945bd0a122e0625f3959f89&#39;,
       &#39;60048dafd9977698423f6d9e45f0d4c2&#39;,
       &#39;c55f334138bd24e209d9c170545c7f62&#39;,
       &#39;cc53f401bf7b6f9d7f0cc42025e3cc65&#39;,
       &#39;8fcfffa4e06cfe09f55215ea1a5e5c84&#39;,
       &#39;617e27a9baf846838a0132bd8871e178&#39;,
       &#39;d82432ca41910a345ee9591c37280484&#39;,
       &#39;1729cc4d62ab0cec44dcfd6757d44d65&#39;,
       &#39;c8b10a317b766204f08e613cef4ce7a0&#39;,
       &#39;867bf3046143d15b9e618c8afba40025&#39;,
       &#39;4c4362be5604f9054c2d6d4f82f9d24e&#39;,
       &#39;b2d16e8bb0e9470fcb2ab15c07b9b4f1&#39;,
       &#39;293a5d2579bc2eb7b20736ae2395e9e5&#39;,
       &#39;3e0c28a1f4b9c11b809ff21dbb920b5c&#39;,
       &#39;05a5fa4dd06e3f64d73d88d7a6885a51&#39;,
       &#39;f2dc994e73107776552b84345c7b2b8d&#39;], dtype=object)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="op">~</span>df[<span class="st">&#39;features&#39;</span>].<span class="bu">str</span>.contains(<span class="st">&#39;\[&#39;</span>), <span class="st">&#39;features&#39;</span>] <span class="op">=</span> <span class="st">&#39;[]&#39;</span></span></code></pre></div>
</div>
<section id="目标是" class="cell markdown">
<h1>目标是</h1>
<pre><code>[[&#39;Doorman&#39;, &#39;Elevator&#39;, &#39;Fitness Center&#39;, &#39;Cats Allowed&#39;, &#39;Dogs Allowed&#39;],
 [&#39;Hardwood Floors&#39;, &#39;No Fee&#39;],
 ..]]

--&gt; 

[&#39;Doorman&#39;, &#39;Elevator&#39;, &#39;Fitness Center&#39;, &#39;Cats Allowed&#39;, &#39;Dogs Allowed&#39;, &#39;Hardwood Floors&#39;, &#39;No Fee&#39;]</code></pre>
</section>
<div class="cell code" data-execution_count="27">
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>feature_nested_list <span class="op">=</span> df[<span class="st">&#39;features&#39;</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>feature_nested_list</span></code></pre></div>
<div class="output execute_result" data-execution_count="27">
<pre><code>0                                                       []
1        [Doorman, Elevator, Fitness Center, Cats Allow...
2        [Laundry In Building, Dishwasher, Hardwood Flo...
3                                [Hardwood Floors, No Fee]
4                                                [Pre-War]
                               ...                        
53670    [Elevator, Laundry in Building, Laundry in Uni...
53671    [Common Outdoor Space, Cats Allowed, Dogs Allo...
53672    [Doorman, Elevator, Pre-War, Dogs Allowed, Cat...
53673    [Doorman, Elevator, Pre-War, Dogs Allowed, Cat...
53674                                    [Hardwood Floors]
Name: features, Length: 53675, dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>feature_nested_list.explode()</span></code></pre></div>
<div class="output execute_result" data-execution_count="28">
<pre><code>0                    NaN
1                Doorman
1               Elevator
1         Fitness Center
1           Cats Allowed
              ...       
53673           Elevator
53673            Pre-War
53673       Dogs Allowed
53673       Cats Allowed
53674    Hardwood Floors
Name: features, Length: 274245, dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="29">
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>feature_unnested <span class="op">=</span> feature_nested_list.explode().dropna()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>feature_unnested</span></code></pre></div>
<div class="output execute_result" data-execution_count="29">
<pre><code>1                Doorman
1               Elevator
1         Fitness Center
1           Cats Allowed
1           Dogs Allowed
              ...       
53673           Elevator
53673            Pre-War
53673       Dogs Allowed
53673       Cats Allowed
53674    Hardwood Floors
Name: features, Length: 266310, dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="30">
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Total number of apartment is &#39;</span>, <span class="bu">len</span>(df[<span class="st">&#39;features&#39;</span>]))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Total number features is&#39;</span>, <span class="bu">len</span>(feature_unnested))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Total number of apartment is  53675
Total number features is 266310
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="31">
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>top_features <span class="op">=</span> feature_unnested.value_counts()[:<span class="dv">10</span>]</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>top_features</span></code></pre></div>
<div class="output execute_result" data-execution_count="31">
<pre><code>Elevator               25759
Hardwood Floors        23445
Cats Allowed           23271
Dogs Allowed           21786
Doorman                20793
Dishwasher             20353
No Fee                 17871
Laundry in Building    16279
Fitness Center         13182
Pre-War                 9120
Name: features, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="32">
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>top_feature_list <span class="op">=</span> <span class="bu">list</span>(top_features.index)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="33" data-scrolled="true">
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>top_feature_list</span></code></pre></div>
<div class="output execute_result" data-execution_count="33">
<pre><code>[&#39;Elevator&#39;,
 &#39;Hardwood Floors&#39;,
 &#39;Cats Allowed&#39;,
 &#39;Dogs Allowed&#39;,
 &#39;Doorman&#39;,
 &#39;Dishwasher&#39;,
 &#39;No Fee&#39;,
 &#39;Laundry in Building&#39;,
 &#39;Fitness Center&#39;,
 &#39;Pre-War&#39;]</code></pre>
</div>
</div>
<div class="cell markdown">
<pre><code>dict {&#39;Elevator&#39;: [0, 0, 1, 1, ...],
      &#39;Hardwood Floors&#39;: [1, 0, ...]}</code></pre>
</div>
<div class="cell code" data-execution_count="34">
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>feature_map <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature_nested <span class="kw">in</span> feature_nested_list:</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature_selected <span class="kw">in</span> top_feature_list:</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> feature_selected <span class="kw">in</span> feature_nested:</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>            feature_map[feature_selected].append(<span class="dv">1</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>            feature_map[feature_selected].append(<span class="dv">0</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;features&#39;</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="35">
<pre><code>0                                                       []
1        [&#39;Doorman&#39;, &#39;Elevator&#39;, &#39;Fitness Center&#39;, &#39;Cat...
2        [&#39;Laundry In Building&#39;, &#39;Dishwasher&#39;, &#39;Hardwoo...
3                            [&#39;Hardwood Floors&#39;, &#39;No Fee&#39;]
4                                              [&#39;Pre-War&#39;]
                               ...                        
53670    [&#39;Elevator&#39;, &#39;Laundry in Building&#39;, &#39;Laundry i...
53671    [&#39;Common Outdoor Space&#39;, &#39;Cats Allowed&#39;, &#39;Dogs...
53672    [&#39;Doorman&#39;, &#39;Elevator&#39;, &#39;Pre-War&#39;, &#39;Dogs Allow...
53673    [&#39;Doorman&#39;, &#39;Elevator&#39;, &#39;Pre-War&#39;, &#39;Dogs Allow...
53674                                  [&#39;Hardwood Floors&#39;]
Name: features, Length: 53675, dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="36">
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>feature_df <span class="op">=</span> pd.DataFrame.from_dict(feature_map)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>feature_df</span></code></pre></div>
<div class="output execute_result" data-execution_count="36">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Elevator</th>
      <th>Hardwood Floors</th>
      <th>Cats Allowed</th>
      <th>Dogs Allowed</th>
      <th>Doorman</th>
      <th>Dishwasher</th>
      <th>No Fee</th>
      <th>Laundry in Building</th>
      <th>Fitness Center</th>
      <th>Pre-War</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53670</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53671</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53672</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53673</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53674</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>53675 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="37">
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> pd.concat([df_final, feature_df], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>df_final</span></code></pre></div>
<div class="output execute_result" data-execution_count="37">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>dscpt_polarity</th>
      <th>dscpt_subjectivity</th>
      <th>Elevator</th>
      <th>Hardwood Floors</th>
      <th>Cats Allowed</th>
      <th>Dogs Allowed</th>
      <th>Doorman</th>
      <th>Dishwasher</th>
      <th>No Fee</th>
      <th>Laundry in Building</th>
      <th>Fitness Center</th>
      <th>Pre-War</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.5</td>
      <td>3.0</td>
      <td>0.136364</td>
      <td>0.454545</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.616667</td>
      <td>0.666667</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.850000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53670</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.175000</td>
      <td>0.775000</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53671</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.160000</td>
      <td>0.540000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53672</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.214286</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53673</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53674</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.000000</td>
      <td>0.750000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>53675 rows × 14 columns</p>
</div>
</div>
</div>
<section id="15-deal-with-photos" class="cell markdown">
<h2>1.5 deal with photos</h2>
</section>
<div class="cell code" data-execution_count="38">
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;photos&#39;</span>][<span class="dv">0</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="38">
<pre><code>&quot;[&#39;https://photos.renthop.com/2/7211212_1ed4542ec81621d70d1061aa833e669c.jpg&#39;, &#39;https://photos.renthop.com/2/7211212_7dfc41dced69245065df83d08eed4a00.jpg&#39;, &#39;https://photos.renthop.com/2/7211212_c17853c4b869af6f53af08b0f5820b4c.jpg&#39;, &#39;https://photos.renthop.com/2/7211212_787ad8ea0c089792e7453e2121f8ac89.jpg&#39;, &#39;https://photos.renthop.com/2/7211212_2e88b0d293ee333c804c2f00536eee49.jpg&#39;]&quot;</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="39">
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;photos&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;photos&#39;</span>].fillna(<span class="st">&#39;[]&#39;</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>df[<span class="op">~</span>df[<span class="st">&#39;photos&#39;</span>].<span class="bu">str</span>.contains(<span class="st">&#39;\[&#39;</span>)]</span></code></pre></div>
<div class="output execute_result" data-execution_count="39">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>building_id</th>
      <th>created</th>
      <th>description</th>
      <th>display_address</th>
      <th>features</th>
      <th>latitude</th>
      <th>listing_id</th>
      <th>longitude</th>
      <th>manager_id</th>
      <th>photos</th>
      <th>price</th>
      <th>street_address</th>
      <th>is_deal</th>
      <th>gender</th>
      <th>expected_price</th>
      <th>followup</th>
      <th>dscpt_polarity</th>
      <th>dscpt_subjectivity</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="40">
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>photo_nested_list <span class="op">=</span> df[<span class="st">&#39;photos&#39;</span>].<span class="bu">apply</span>(ast.literal_eval)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>photo_nested_list[:<span class="dv">2</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="40">
<pre><code>0    [https://photos.renthop.com/2/7211212_1ed4542e...
1    [https://photos.renthop.com/2/7150865_be3306c5...
Name: photos, dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="41">
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>num_of_photos <span class="op">=</span> photo_nested_list.<span class="bu">apply</span>(<span class="bu">len</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>num_of_photos[:<span class="dv">2</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="41">
<pre><code>0     5
1    11
Name: photos, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="42">
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df_final[<span class="st">&#39;num_of_photos&#39;</span>] <span class="op">=</span> num_of_photos</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>df_final[[<span class="st">&#39;num_of_photos&#39;</span>]].head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="42">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>num_of_photos</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="16-deal-with-gender" class="cell markdown">
<h1>1.6 deal with gender</h1>
</section>
<div class="cell code" data-execution_count="43">
<div class="sourceCode" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pd.get_dummies(df[<span class="st">&#39;gender&#39;</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="43">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>male</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>53670</th>
      <td>1</td>
    </tr>
    <tr>
      <th>53671</th>
      <td>0</td>
    </tr>
    <tr>
      <th>53672</th>
      <td>0</td>
    </tr>
    <tr>
      <th>53673</th>
      <td>0</td>
    </tr>
    <tr>
      <th>53674</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>53675 rows × 1 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="44">
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df_final[<span class="st">&#39;gender&#39;</span>] <span class="op">=</span> pd.get_dummies(df[<span class="st">&#39;gender&#39;</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<section id="17-other-features" class="cell markdown">
<h1>1.7 other features</h1>
</section>
<div class="cell code" data-execution_count="57" data-scrolled="true">
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df_final.to_csv(<span class="st">&#39;final.csv&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="46">
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df[<span class="st">&#39;is_deal&#39;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="47">
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>(labels <span class="op">==</span> <span class="dv">0</span>))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>(labels <span class="op">==</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>41110
12565
</code></pre>
</div>
</div>
<section id="2-数据分割和均一化" class="cell markdown">
<h1>2. 数据分割和均一化</h1>
</section>
<section id="21-均一化" class="cell markdown">
<h2>2.1 均一化</h2>
</section>
<div class="cell code" data-execution_count="48">
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df_final.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 53675 entries, 0 to 53674
Data columns (total 19 columns):
 #   Column               Non-Null Count  Dtype  
---  ------               --------------  -----  
 0   bathrooms            49352 non-null  float64
 1   bedrooms             49352 non-null  float64
 2   dscpt_polarity       53675 non-null  float64
 3   dscpt_subjectivity   53675 non-null  float64
 4   Elevator             53675 non-null  int64  
 5   Hardwood Floors      53675 non-null  int64  
 6   Cats Allowed         53675 non-null  int64  
 7   Dogs Allowed         53675 non-null  int64  
 8   Doorman              53675 non-null  int64  
 9   Dishwasher           53675 non-null  int64  
 10  No Fee               53675 non-null  int64  
 11  Laundry in Building  53675 non-null  int64  
 12  Fitness Center       53675 non-null  int64  
 13  Pre-War              53675 non-null  int64  
 14  num_of_photos        53675 non-null  int64  
 15  gender               53675 non-null  uint8  
 16  price                48755 non-null  float64
 17  expected_price       48755 non-null  float64
 18  followup             26872 non-null  float64
dtypes: float64(7), int64(11), uint8(1)
memory usage: 7.4 MB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="107">
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>features_standard <span class="op">=</span> [<span class="st">&#39;num_of_photos&#39;</span>, <span class="st">&#39;price&#39;</span>, <span class="st">&#39;expected_price&#39;</span>, <span class="st">&#39;followup&#39;</span>]</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>df_standard <span class="op">=</span> df_final[features_standard]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>df_standard.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="107">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>num_of_photos</th>
      <th>price</th>
      <th>expected_price</th>
      <th>followup</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5</td>
      <td>3000.0</td>
      <td>2700.0</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>11</td>
      <td>5465.0</td>
      <td>5200.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>2850.0</td>
      <td>2900.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>3275.0</td>
      <td>3500.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>3350.0</td>
      <td>3200.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="108">
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> StandardScaler()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>df_standard <span class="op">=</span>sc.fit_transform(df_standard)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>df_standard <span class="op">=</span> sc.transform(df_standard)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="109">
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>df_final[features_standard] <span class="op">=</span> df_standard</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="56">
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df_final</span></code></pre></div>
<div class="output execute_result" data-execution_count="56">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>dscpt_polarity</th>
      <th>dscpt_subjectivity</th>
      <th>Elevator</th>
      <th>Hardwood Floors</th>
      <th>Cats Allowed</th>
      <th>Dogs Allowed</th>
      <th>Doorman</th>
      <th>Dishwasher</th>
      <th>No Fee</th>
      <th>Laundry in Building</th>
      <th>Fitness Center</th>
      <th>Pre-War</th>
      <th>num_of_photos</th>
      <th>gender</th>
      <th>price</th>
      <th>expected_price</th>
      <th>followup</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.5</td>
      <td>3.0</td>
      <td>0.136364</td>
      <td>0.454545</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>3000.0</td>
      <td>2700.0</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>11</td>
      <td>1</td>
      <td>5465.0</td>
      <td>5200.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.616667</td>
      <td>0.666667</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>8</td>
      <td>1</td>
      <td>2850.0</td>
      <td>2900.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>3275.0</td>
      <td>3500.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.850000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>3350.0</td>
      <td>3200.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53670</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.175000</td>
      <td>0.775000</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>3200.0</td>
      <td>3500.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>53671</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.160000</td>
      <td>0.540000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>8</td>
      <td>0</td>
      <td>3950.0</td>
      <td>3500.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>53672</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.214286</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>2595.0</td>
      <td>2200.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>53673</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9</td>
      <td>0</td>
      <td>3350.0</td>
      <td>3900.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>53674</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.000000</td>
      <td>0.750000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>2200.0</td>
      <td>2300.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>53675 rows × 19 columns</p>
</div>
</div>
</div>
<section id="22-数据分割" class="cell markdown">
<h2>2.2 数据分割</h2>
</section>
<div class="cell code" data-execution_count="111">
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 30% examples in test data</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>train, test, train_labels, test_labels <span class="op">=</span> train_test_split(df_final, labels, </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                                                          stratify <span class="op">=</span> labels,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                                                          test_size <span class="op">=</span> <span class="fl">0.3</span>, </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                                                          random_state <span class="op">=</span> RSEED)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> train.fillna(train.mean())</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> test.fillna(test.mean())</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Features for feature importances</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> <span class="bu">list</span>(train.columns)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="112">
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;training sample is &#39;</span>, train.shape)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;test sample is&#39;</span>, test.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>training sample is  (37572, 19)
test sample is (16103, 19)
</code></pre>
</div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb91"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Descriptive analysis</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="58">
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To begin this exploratory analysis, first import libraries and define functions and utilities to work with the data.</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co"># plotting</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># linear algebra</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os <span class="co"># accessing directory structure</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># data processing, CSV file I/O (e.g. pd.read_csv)</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for beautiful plots and some types of graphs</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="60">
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plotCorrelationMatrix(df, graphWidth, segmentName<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> segmentName <span class="cf">if</span> segmentName <span class="cf">else</span> <span class="bu">getattr</span>(df, <span class="st">&quot;dataframeName&quot;</span>, segmentName)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(<span class="st">&#39;columns&#39;</span>) <span class="co"># drop columns with NaN</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[col <span class="cf">for</span> col <span class="kw">in</span> df <span class="cf">if</span> df[col].nunique() <span class="op">&gt;</span> <span class="dv">1</span>]] <span class="co"># keep columns where there are more than 1 unique values</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.shape[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;No correlation plots shown: The number of non-NaN or constant columns (</span><span class="sc">{df.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">) is less than 2&#39;</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    corr <span class="op">=</span> df.corr()</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    plt.figure(num<span class="op">=</span><span class="va">None</span>, figsize<span class="op">=</span>(graphWidth, graphWidth), dpi<span class="op">=</span><span class="dv">80</span>, facecolor<span class="op">=</span><span class="st">&#39;w&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;k&#39;</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    corrMat <span class="op">=</span> plt.matshow(corr, fignum <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(corr.columns)), corr.columns, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>    plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(corr.columns)), corr.columns)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    plt.gca().xaxis.tick_bottom()</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(corrMat)</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f&#39;Correlation Matrix for </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="64">
<div class="sourceCode" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df_final1<span class="op">=</span>df_final</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="65">
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df_final1[<span class="st">&quot;is_deal&quot;</span>]<span class="op">=</span> df[<span class="st">&quot;is_deal&quot;</span>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="67">
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df_final1</span></code></pre></div>
<div class="output execute_result" data-execution_count="67">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bathrooms</th>
      <th>bedrooms</th>
      <th>dscpt_polarity</th>
      <th>dscpt_subjectivity</th>
      <th>Elevator</th>
      <th>Hardwood Floors</th>
      <th>Cats Allowed</th>
      <th>Dogs Allowed</th>
      <th>Doorman</th>
      <th>Dishwasher</th>
      <th>No Fee</th>
      <th>Laundry in Building</th>
      <th>Fitness Center</th>
      <th>Pre-War</th>
      <th>num_of_photos</th>
      <th>gender</th>
      <th>price</th>
      <th>expected_price</th>
      <th>followup</th>
      <th>is_deal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.5</td>
      <td>3.0</td>
      <td>0.136364</td>
      <td>0.454545</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>3000.0</td>
      <td>2700.0</td>
      <td>13.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>11</td>
      <td>1</td>
      <td>5465.0</td>
      <td>5200.0</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.616667</td>
      <td>0.666667</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>8</td>
      <td>1</td>
      <td>2850.0</td>
      <td>2900.0</td>
      <td>NaN</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>3275.0</td>
      <td>3500.0</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.850000</td>
      <td>1.000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>3350.0</td>
      <td>3200.0</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>53670</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.175000</td>
      <td>0.775000</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>3200.0</td>
      <td>3500.0</td>
      <td>7.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53671</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.160000</td>
      <td>0.540000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>8</td>
      <td>0</td>
      <td>3950.0</td>
      <td>3500.0</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53672</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.214286</td>
      <td>0.428571</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>2595.0</td>
      <td>2200.0</td>
      <td>5.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>53673</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9</td>
      <td>0</td>
      <td>3350.0</td>
      <td>3900.0</td>
      <td>15.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>53674</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.000000</td>
      <td>0.750000</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>2200.0</td>
      <td>2300.0</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>53675 rows × 20 columns</p>
</div>
</div>
</div>
<div class="cell code" data-execution_count="73">
<div class="sourceCode" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>df_final1.hist(figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">10</span>))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_133339d904bb4c8b83fcbacf4047f39d/cad7cb3aefe049b3437a8bc6059981aad95d7a80.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="72">
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df_final1.to_csv(<span class="st">&#39;final2.csv&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="68">
<div class="sourceCode" id="cb99"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>plotCorrelationMatrix(df_final1, <span class="dv">8</span>, <span class="st">&quot;All inquiries&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_133339d904bb4c8b83fcbacf4047f39d/06751d734ee24bc6f416c96fcab36abc4cd943a2.png" /></p>
</div>
</div>
<section id="3-模型training" class="cell markdown">
<h1>3. 模型training</h1>
<h2 id="31-baseline-model-logistic-regression">3.1 Baseline Model: Logistic Regression</h2>
</section>
<div class="cell code" data-execution_count="237">
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>performance <span class="op">=</span> {}</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="231">
<div class="sourceCode" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score, recall_score, accuracy_score, f1_score</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="232">
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>logregModel <span class="op">=</span> LogisticRegression(C<span class="op">=</span><span class="dv">400</span>) <span class="co">#instantiate</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>logregModel.fit(train, train_labels) <span class="co"># fit model</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="232">
<pre><code>LogisticRegression(C=400, class_weight=None, dual=False, fit_intercept=True,
                   intercept_scaling=1, l1_ratio=None, max_iter=100,
                   multi_class=&#39;auto&#39;, n_jobs=None, penalty=&#39;l2&#39;,
                   random_state=None, solver=&#39;lbfgs&#39;, tol=0.0001, verbose=0,
                   warm_start=False)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="233">
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> logregModel.predict(train)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Precision = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(precision_score(train_labels, preds, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>)))</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Recall = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(recall_score(train_labels, preds, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>)))</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Accuracy = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(accuracy_score(train_labels, preds)))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Precision = 0.3829487077111448
Recall = 0.4999478750390937
Accuracy = 0.7658362610454594
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="242">
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> logregModel.predict(test)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>pres, rec, acc <span class="op">=</span> (</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    precision_score(test_labels, preds, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    recall_score(test_labels, preds, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    accuracy_score(test_labels, preds)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Precision = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(pres))</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Recall = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(rec))</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Accuracy = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(acc))</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>performance[<span class="st">&#39;logistic&#39;</span>] <span class="op">=</span> (pres, rec, acc)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Precision = 0.3829337970438455
Recall = 0.49995945836373956
Accuracy = 0.7658200335341241
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="238">
<div class="sourceCode" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<div class="cell code" data-execution_count="239">
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>preds.<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="239">
<pre><code>1</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="240">
<div class="sourceCode" id="cb111"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>test_labels.<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="240">
<pre><code>3770</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="241">
<div class="sourceCode" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>logregModel.coef_</span></code></pre></div>
<div class="output execute_result" data-execution_count="241">
<pre><code>array([[-0.29929301,  0.09454247,  0.07624918, -0.11582866, -0.05648102,
         0.07078875,  0.02854568, -0.32849005, -0.48165352, -0.04013258,
         0.33048016,  0.14803438, -0.04653605, -0.38846947, -0.60667547,
         0.2961993 ,  0.27502064,  0.27141961,  0.01495243]])</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="169">
<div class="sourceCode" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">zip</span>(train.columns, logregModel.coef_[<span class="dv">0</span>]))</span></code></pre></div>
<div class="output execute_result" data-execution_count="169">
<pre><code>[(&#39;bathrooms&#39;, -0.29929301245574685),
 (&#39;bedrooms&#39;, 0.09454246900499783),
 (&#39;dscpt_polarity&#39;, 0.07624917741119284),
 (&#39;dscpt_subjectivity&#39;, -0.11582866052570917),
 (&#39;Elevator&#39;, -0.05648102051132694),
 (&#39;Hardwood Floors&#39;, 0.0707887473203212),
 (&#39;Cats Allowed&#39;, 0.028545678014498817),
 (&#39;Dogs Allowed&#39;, -0.32849004812842847),
 (&#39;Doorman&#39;, -0.4816535157251992),
 (&#39;Dishwasher&#39;, -0.040132580538014065),
 (&#39;No Fee&#39;, 0.33048016290616455),
 (&#39;Laundry in Building&#39;, 0.14803437913491685),
 (&#39;Fitness Center&#39;, -0.04653605494041259),
 (&#39;Pre-War&#39;, -0.38846947244239505),
 (&#39;num_of_photos&#39;, -0.6066754688644703),
 (&#39;gender&#39;, 0.29619930433736713),
 (&#39;price&#39;, 0.27502064058348635),
 (&#39;expected_price&#39;, 0.2714196058080121),
 (&#39;followup&#39;, 0.014952430083192688)]</code></pre>
</div>
</div>
<section id="32-model-selection" class="cell markdown">
<h2>3.2 Model Selection</h2>
<h3 id="311-decision-tree">3.1.1 decision tree</h3>
</section>
<div class="cell code" data-execution_count="170">
<div class="sourceCode" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a decision tree and train</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>treeModel <span class="op">=</span> tree.DecisionTreeClassifier()</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>treeModel.fit(train, train_labels)</span></code></pre></div>
<div class="output execute_result" data-execution_count="170">
<pre><code>DecisionTreeClassifier(ccp_alpha=0.0, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=None, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, presort=&#39;deprecated&#39;,
                       random_state=None, splitter=&#39;best&#39;)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="255">
<div class="sourceCode" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>preds2 <span class="op">=</span> treeModel.predict(test)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>pres, rec, acc <span class="op">=</span> (</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    precision_score(test_labels, preds2, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    recall_score(test_labels, preds2, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    accuracy_score(test_labels, preds2)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Precision = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(pres))</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Recall = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(rec))</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Accuracy = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(acc))</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>performance[<span class="st">&#39;decision_tree&#39;</span>] <span class="op">=</span> (pres, rec, acc)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Precision = 0.5254073872315648
Recall = 0.5233045692037128
Accuracy = 0.6722349872694529
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="172">
<div class="sourceCode" id="cb121"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>fi_model <span class="op">=</span> pd.DataFrame({<span class="st">&#39;feature&#39;</span>: features,</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;importance&#39;</span>: treeModel.feature_importances_}).<span class="op">\</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>                    sort_values(<span class="st">&#39;importance&#39;</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>fi_model.head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="172">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17</th>
      <td>expected_price</td>
      <td>0.170748</td>
    </tr>
    <tr>
      <th>16</th>
      <td>price</td>
      <td>0.149383</td>
    </tr>
    <tr>
      <th>14</th>
      <td>num_of_photos</td>
      <td>0.115779</td>
    </tr>
    <tr>
      <th>18</th>
      <td>followup</td>
      <td>0.107736</td>
    </tr>
    <tr>
      <th>2</th>
      <td>dscpt_polarity</td>
      <td>0.106574</td>
    </tr>
    <tr>
      <th>3</th>
      <td>dscpt_subjectivity</td>
      <td>0.106042</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bedrooms</td>
      <td>0.040414</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Laundry in Building</td>
      <td>0.020219</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Dishwasher</td>
      <td>0.020166</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Elevator</td>
      <td>0.019413</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="312-random-forest" class="cell markdown">
<h3>3.1.2 random forest</h3>
</section>
<div class="cell code" data-execution_count="149">
<div class="sourceCode" id="cb122"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model with 100 trees</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>RM_model <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, </span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>                               random_state<span class="op">=</span>RSEED, </span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>                               max_features <span class="op">=</span> <span class="st">&#39;sqrt&#39;</span>,</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>                               n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit on training data</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>RM_model.fit(train, train_labels)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 8 concurrent workers.
[Parallel(n_jobs=-1)]: Done  34 tasks      | elapsed:    0.2s
[Parallel(n_jobs=-1)]: Done 100 out of 100 | elapsed:    0.7s finished
</code></pre>
</div>
<div class="output execute_result" data-execution_count="149">
<pre><code>RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                       criterion=&#39;gini&#39;, max_depth=None, max_features=&#39;sqrt&#39;,
                       max_leaf_nodes=None, max_samples=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=100,
                       n_jobs=-1, oob_score=False, random_state=30, verbose=1,
                       warm_start=False)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="254">
<div class="sourceCode" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>preds3 <span class="op">=</span> RM_model.predict(test)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>pres, rec, acc <span class="op">=</span> (</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    precision_score(test_labels, preds3, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    recall_score(test_labels, preds3, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>    accuracy_score(test_labels, preds3)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Precision = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(pres))</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Recall = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(rec))</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Accuracy = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(acc))</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>performance[<span class="st">&#39;random_forest&#39;</span>] <span class="op">=</span> (pres, rec, acc)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Precision = 0.589082748323531
Recall = 0.5173644129603331
Accuracy = 0.7590511084891014
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>[Parallel(n_jobs=8)]: Using backend ThreadingBackend with 8 concurrent workers.
[Parallel(n_jobs=8)]: Done  34 tasks      | elapsed:    0.0s
[Parallel(n_jobs=8)]: Done 100 out of 100 | elapsed:    0.0s finished
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="174">
<div class="sourceCode" id="cb128"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>fi_model <span class="op">=</span> pd.DataFrame({<span class="st">&#39;feature&#39;</span>: features,</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;importance&#39;</span>: RM_model.feature_importances_}).<span class="op">\</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>                    sort_values(<span class="st">&#39;importance&#39;</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>fi_model.head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="174">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17</th>
      <td>expected_price</td>
      <td>0.170170</td>
    </tr>
    <tr>
      <th>16</th>
      <td>price</td>
      <td>0.146372</td>
    </tr>
    <tr>
      <th>14</th>
      <td>num_of_photos</td>
      <td>0.113439</td>
    </tr>
    <tr>
      <th>18</th>
      <td>followup</td>
      <td>0.107116</td>
    </tr>
    <tr>
      <th>2</th>
      <td>dscpt_polarity</td>
      <td>0.101994</td>
    </tr>
    <tr>
      <th>3</th>
      <td>dscpt_subjectivity</td>
      <td>0.100606</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bedrooms</td>
      <td>0.054621</td>
    </tr>
    <tr>
      <th>15</th>
      <td>gender</td>
      <td>0.021725</td>
    </tr>
    <tr>
      <th>0</th>
      <td>bathrooms</td>
      <td>0.020426</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Elevator</td>
      <td>0.018922</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="313-xgboost" class="cell markdown">
<h3>3.1.3 xgboost</h3>
</section>
<div class="cell code" data-execution_count="248">
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>param <span class="op">=</span> {</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;eta&#39;</span>: <span class="fl">0.3</span>, </span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_depth&#39;</span>: <span class="dv">3</span>,  </span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;objective&#39;</span>: <span class="st">&#39;binary:logistic&#39;</span>,</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="op">=</span> XGBClassifier(<span class="op">**</span>param)</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>xgb_model.fit(X<span class="op">=</span>train, y<span class="op">=</span>train_labels)</span></code></pre></div>
<div class="output execute_result" data-execution_count="248">
<pre><code>XGBClassifier(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
              colsample_bynode=1, colsample_bytree=1, eta=0.3, gamma=0,
              gpu_id=-1, importance_type=&#39;gain&#39;, interaction_constraints=&#39;&#39;,
              learning_rate=0.300000012, max_delta_step=0, max_depth=3,
              min_child_weight=1, missing=nan, monotone_constraints=&#39;()&#39;,
              n_estimators=100, n_jobs=0, num_parallel_tree=1,
              objective=&#39;binary:logistic&#39;, random_state=0, reg_alpha=0,
              reg_lambda=1, scale_pos_weight=1, subsample=1,
              tree_method=&#39;exact&#39;, validate_parameters=1, verbosity=None)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="249">
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>xgb_preds <span class="op">=</span> xgb_model.predict(test)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>pres, rec, acc <span class="op">=</span> (</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    precision_score(test_labels, xgb_preds, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    recall_score(test_labels, xgb_preds, average<span class="op">=</span><span class="st">&#39;macro&#39;</span>),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    accuracy_score(test_labels, xgb_preds)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Precision = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(pres))</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Recall = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(rec))</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Accuracy = </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(acc))</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>performance[<span class="st">&#39;xgboost&#39;</span>] <span class="op">=</span> (pres, rec, acc)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Precision = 0.649815180338051
Recall = 0.5215188122870623
Accuracy = 0.7672483388188537
</code></pre>
</div>
</div>
<section id="32-compare" class="cell markdown">
<h2>3.2 Compare</h2>
</section>
<div class="cell code" data-execution_count="256">
<div class="sourceCode" id="cb133"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(performance, index<span class="op">=</span>[<span class="st">&#39;precision&#39;</span>, <span class="st">&#39;recall&#39;</span>, <span class="st">&#39;accuracy&#39;</span>])</span></code></pre></div>
<div class="output execute_result" data-execution_count="256">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>logistic</th>
      <th>decision_tree</th>
      <th>xgboost</th>
      <th>random_forest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>precision</th>
      <td>0.382934</td>
      <td>0.525407</td>
      <td>0.649815</td>
      <td>0.589083</td>
    </tr>
    <tr>
      <th>recall</th>
      <td>0.499959</td>
      <td>0.523305</td>
      <td>0.521519</td>
      <td>0.517364</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.765820</td>
      <td>0.672235</td>
      <td>0.767248</td>
      <td>0.759051</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="257">
<div class="sourceCode" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_labels, xgb_preds))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.77      0.98      0.87     12333
           1       0.53      0.06      0.11      3770

    accuracy                           0.77     16103
   macro avg       0.65      0.52      0.49     16103
weighted avg       0.72      0.77      0.69     16103

</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="258">
<div class="sourceCode" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>confusion_matrix(test_labels, best_preds)</span></code></pre></div>
<div class="output execute_result" data-execution_count="258">
<pre><code>array([[12244,    89],
       [ 3668,   102]], dtype=int64)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="259">
<div class="sourceCode" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> plot_importance</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>plot_importance(xgb_model, max_num_features<span class="op">=</span><span class="dv">10</span>, height<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>pyplot.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_133339d904bb4c8b83fcbacf4047f39d/17d3c02ab836cb9b9c9bef3e9c97ab9dfef0c5ff.png" /></p>
</div>
</div>
<section id="可以进行的模型改进" class="cell markdown">
<h2>可以进行的模型改进</h2>
<ol>
<li>处理数据不平衡问题，防止出现某一个类别几乎dominate</li>
<li>模型参数调整</li>
<li>其他变量的研究</li>
</ol>
</section>
</body>
</html>
